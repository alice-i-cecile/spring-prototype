<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Spring Prototype</title>
    <link href="/stylesheets/screen.css" media="all" rel="stylesheet" type="text/css"/>
    <script language="javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script><script language="javascript" src="javascripts/jquery.hotkeys.js" type="text/javascript"></script><script language="javascript" src="javascripts/key_status.js" type="text/javascript"></script><script language="javascript" src="javascripts/util.js" type="text/javascript"></script><script language="javascript" src="javascripts/sprite.js" type="text/javascript"></script><script language="javascript" src="javascripts/sound.js" type="text/javascript"></script>
  </head>
  <body>
    <h1>Spring Prototype</h1>
    <script type='text/javascript'>
      //<![CDATA[
        var CANVAS_WIDTH = 1600;
        var CANVAS_HEIGHT = 900;
        var FPS = 30;

        var canvasElement = $("<canvas width='" + CANVAS_WIDTH +
          "' height='" + CANVAS_HEIGHT + "'></canvas");
        var canvas = canvasElement.get(0).getContext("2d");
        canvasElement.appendTo('body');

        setInterval(function() {
          update();
          draw();
        }, 1000/FPS);

        var player = {
          x: CANVAS_WIDTH/2,
          y: CANVAS_HEIGHT/2,
          v_x: 0,
          v_y: 0,
          acceleration_rate : 1,
          drag_coefficient : 0.05,
          radius: 15,
          draw: function() {
            canvas.beginPath();
            canvas.arc(this.x, this.y,
              this.radius,
              0, 2*Math.PI);
            canvas.stroke();
          }
        };

        function update() {
          // Controls
          // FIXME: Allows for faster diagonal movement 
          if(keydown.left) {
            player.v_x -= player.acceleration_rate;
          }

          if(keydown.right) {
            player.v_x += player.acceleration_rate;
          }

          if(keydown.up) {
            player.v_y -= player.acceleration_rate;
          }

          if(keydown.down) {
            player.v_y += player.acceleration_rate;
          }

          // Drag
          player.v_x *= 1 - player.drag_coefficient
          player.v_y *= 1 - player.drag_coefficient

          // Movement
          player.x += player.v_x
          player.y += player.v_y

          // Bounding
          player.x = player.x.clamp(player.radius, CANVAS_WIDTH - player.radius);
          player.y = player.y.clamp(player.radius, CANVAS_HEIGHT - player.radius);
        }

        function draw() {
          canvas.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
          canvas.strokeRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
          player.draw();
        }

      //]]>
    </script>
  </body>
</html>
